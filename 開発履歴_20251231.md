# Note AI Agent 2 開発プロジェクト構成・改善履歴

本ドキュメントは、2025年12月末に行われた「Note AI Agent 2」の本格的な機能強化（Reproフェーズ）における主要な意思決定と改善のプロセスを記録したものです。

---

## 開発マイルストーン

### 1. 【課題】画像生成の不安定さと透かしの除去
*   **状況**: 初期の画像生成では外部APIの「透かし（Watermark）」が入る、あるいは画像が壊れる問題が発生していた。
*   **解決**: Google Geminiの `v1beta` エンドポイントを直接叩くロジックへ移行。`gemini-3-pro-image-preview`（Nano Banana Pro）を採用。
*   **結果**: 16:9の高品質かつ透かしのない純粋な画像を安定して得られるようになった。

### 2. 【デバッグテスト 1】ナノバナナの実力確認
*   **内容**: 「量子コンピュータ × 猫」のような、抽象的かつ具体的な指示。
*   **学び**: モデルがプロンプトの細かなニュアンス（例：背景のグラデーション、ライティング）を極めて正確に再現することを確認。
*   **適用**: この成功を受け、アプリのメイン画像生成エンジンとして固定。

### 3. 【デバッグテスト 2】note記事としてのプロ級デザイン
*   **内容**: noteの見栄えに合わせたタイトルのオーバーレイ。
*   **学び**: 背景の一部をぼかす `backdrop-blur` とグラデーションの組み合わせが、最も「高級感」を生むことを発見。
*   **適用**: CSSを微調整し、アプリの「書き出し」画面をnoteの投稿プレビューのような質感に統一。

### 4. 【デバッグテスト 3】フルパッケージ生成の確立
*   **内容**: 「キャバ嬢のサンドイッチ」というテーマ。人物キャラの維持、見出し、メタデータの同時生成。
*   **学び**: ユーザーは記事本文だけでなく、「実際にそのままnoteの各項目にコピペできる素材一式」を求めていることを再認識。
*   **適用**: ブラウザ上でのタブ切替（生データ / プレビュー / スコア）を導入し、記事内画像（インライン）とメタディスクリプションの自動生成フローを追加。

---

## 技術的な重要ロジックの変遷

1.  **プロンプトエンジニアリング**:
    *   単に「画像を作れ」ではなく、記事の内容からAIが「ビジュアルテーマ」を一度推論し、それをNano Banana Pro向けの英語プロンプトに変換してから生成する2段構えのロジックを構築。
2.  **一貫性の維持**:
    *   `referenceImage` （ユーザーのアップロード画像）がある場合、そのBase64データを直接モデルに渡すことで、生成されるすべての画像でキャラクターや色味を一貫させることに成功。
3.  **フォールバックの多重化**:
    *   Google APIが混雑時にエラーを返した場合でも、瞬時にPollinations AIへ切り替えることで、ユーザーに「生成失敗」を感じさせない堅牢なコードを実現。

---

## 開発者メモ (Antigravityより)
このプロジェクトを通じて、「AIが書く」から「エージェントがメディアを完成させる」というパラダイムシフトを実現できました。特に Nano Banana Pro の指示理解力は、今後のあらゆるWebアプリケーションにおける画像生成のスタンダードになると確信しています。

**記録日**: 2025年12月31日
**ステータス**: フェーズ2（Repro）完了
