# Note AI Agent 2 開発プロジェクト構成・改善履歴

本ドキュメントは、2025年12月末に行われた「Note AI Agent 2」の本格的な機能強化（Reproフェーズ）における主要な意思決定と改善のプロセスを記録したものです。

---

## 開発マイルストーン

### 1. 【課題】画像生成の不安定さと透かしの除去
*   **状況**: 初期の画像生成では外部APIの「透かし（Watermark）」が入る、あるいは画像が壊れる問題が発生していた。
*   **解決**: Google Geminiの `v1beta` エンドポイントを直接叩くロジックへ移行。`gemini-3-pro-image-preview`（Nano Banana Pro）を採用。
*   **結果**: 16:9の高品質かつ透かしのない純粋な画像を安定して得られるようになった。

### 2. 【デバッグテスト 1】ナノバナナの実力確認
*   **内容**: 「量子コンピュータ × 猫」のような、抽象的かつ具体的な指示。
*   **学び**: モデルがプロンプトの細かなニュアンス（例：背景のグラデーション、ライティング）を極めて正確に再現することを確認。
*   **適用**: この成功を受け、アプリのメイン画像生成エンジンとして固定。

### 3. 【デバッグテスト 2】note記事としてのプロ級デザイン
*   **内容**: noteの見栄えに合わせたタイトルのオーバーレイ。
*   **学び**: 背景の一部をぼかす `backdrop-blur` とグラデーションの組み合わせが、最も「高級感」を生むことを発見。
*   **適用**: CSSを微調整し、アプリの「書き出し」画面をnoteの投稿プレビューのような質感に統一。

### 4. 【デバッグテスト 3】フルパッケージ生成の確立
*   **内容**: 「キャバ嬢のサンドイッチ」というテーマ。人物キャラの維持、見出し、メタデータの同時生成。
*   **学び**: ユーザーは記事本文だけでなく、「実際にそのままnoteの各項目にコピペできる素材一式」を求めていることを再認識。
*   **適用**: ブラウザ上でのタブ切替（生データ / プレビュー / スコア）を導入し、記事内画像（インライン）とメタディスクリプションの自動生成フローを追加。

### 5. 【デバッグテスト 7】「王道」デザインの確立
*   **内容**: 「AI活用の最新情報（ワークフロー）」テーマ。
*   **学び**: キャラクターに「白縁（ステッカー風）」をつけ、周囲に「コネクテッド・アイコン（関連図）」を浮かべることで、技術解説記事としての信頼性と分かりやすさが劇的に向上することを発見。
*   **適用**: 「ステッカー・スタイル」と「アイコン接続」をAI의 プロンプト構成に正式採用。また、参照画像の特徴を絶対視する「Strict Mode（必須設定）」トグルをUIに搭載。

### 6. 【最終最適化】マルチモーダル結合による一貫性の完成
*   **内容**: キャラクター必須設定（Strict Mode）の最終調整。
*   **成果**: 女子キャラのステッカー風描写とワークフローのアイコン接続が想定通りのクオリティで安定出力。

### 7. 【ブランディングと法務リスク対応】独自性の確立
*   **内容**: note.comとの混同を避けるためのUI差別化（リネーム・色彩・フォント）。
### 8. 【利便性の極大化】蓄積と連続性の確保
*   **内容**: 履歴機能と入力永続化の実装。
*   **課題**: 「一度ページを離れると設定が消える」「過去に作った最高の記事を後から見返せない」というUX上の欠点を解消。
*   **解決**: `localStorage` をフル活用し、入力フォームの自動保存と、生成済みパッケージのアーカイブ（履歴履歴）機能を搭載。また、全章の画像を後から一括生成できる「章別画像オンデマンド生成」を実装。
*   **成果**: 納得いくまで調整を繰り返す「執筆の試行錯誤」が可能になり、AIエージェントとしての実用性が格格に向上。

---

### 9. 【信頼性とアクセシビリティ】完遂するエージェント
*   **内容**: スマートリトライ、動的推薦、スマホ最適化の実装。
*   **課題**: 文字数が足りない場合の物足りなさ、固定的なAI推薦の味気なさ、およびモバイル端末での表示・動作の不安定さを解消。
*   **解決**: 文字数目標に満たない場合の「加筆指示付き自動リトライ」を導入。AIおまかせ設定を「現在のテーマから動的に生成する」ロジックに変更。スマホビュー専用の調整（フォントサイズ、レスポンシブなタブ表示、ログの詳細化）を徹底。
*   **成果**: デバイスを問わず「指示さえ出せば、期待通りの長さと質の記事が必ず手に入る」という信頼感を確立。

---

## 技術的な重要ロジックの変遷

1.  **プロンプトエンジニアリングの二段階進化**:
    *   初期：記事からタイトルを抽出。
    *   現在：記事の内容から「比喩・メタファー」や「ワークフロー要素」をAIが予見し、デザイン的な味付け（ステッカー、ライティング）をプロンプトに動的に付与。
2.  **一貫性の維持とマルチモーダル入力**:
    *   `Strict Mode`の実装に加え、Base64画像を生成エンジン（Nano Banana Pro）に直接渡す「マルチモーダル・フィード」を確立。
3.  **動的なメタデータ・インジェクション**:
    *   生成された記事内の「見出し」をリアルタイムで解析し、それを画像生成のプロンプトや、UI上の画像オーバーレイに即座に反映させる同期ロジックを確立。
4.  **ローカルデータ・マネジメント**:
    *   複雑な「記事パッケージ（本文・画像・スコア・設定）」をステートレスなブラウザ環境で安全に保存・復元するためのシリアライズ・デシリアライズ処理を確立。
5.  **再帰的品質保証プロセス**:
    *   生成物の「長さ」をクライアントサイドで評価し、不足している場合にバックエンドへ「どこを強化すべきか」のフィードバックと共に再リクエストを送る「自己修正ループ」を確立。

---

**記録日**: 2025年12月31日
**ステータス**: フェーズ5（Reliability & Mobile）完了。最終安定版 v3.3。
