# Note AI Agent 2 仕様書 (v1.1)

## 1. プロダクト概要
**コンセプト:** 「noteを書くツール」ではなく、知識を即座に商品レベルのコンテンツに変換し、収益化まで導く「AI編集者パートナー」。
**主な特徴:**
*   知識やメモを入力するだけで、noteに投稿可能な記事構成・本文を自動生成。
*   **「AIにおまかせ設定」機能**により、テーマだけ決まれば最適なターゲット設定をAIが提案。
*   記事の内容に基づいた「アイキャッチ画像」を自動生成。**画風やキャラクターの指定**、**タイトル文字の合成表示**も可能。
*   独自の「記事品質スコア」による客観的な評価と改善提案。
*   記事生成後の「X告知文作成」「有料note化アイデア」など、収益化へのネクストアクションをサポート。

---

## 2. システムアーキテクチャ
*   **Frontend:** Next.js (App Router), Tailwind CSS
*   **Backend:** Next.js API Routes (Serverless Functions)
*   **Infrastructure:** Vercel
*   **AI Provider:** Google Gemini API (Google AI Studio)

### 2.1 使用モデル (Model Strategy)
本プロダクトでは、以下のモデルを「基本（Primary）」として使用する。

*   **文章生成 (Text Generation):**
    *   **Primary:** `gemini-3-flash-preview`
    *   **Role:** 長文の文脈理解、高速な生成、自然な日本語の執筆。
    *   **Fallback:** `gemini-2.0-flash-exp`, `gemini-1.5-flash`

*   **画像生成 (Image Generation):**
    *   **Primary:** `gemini-3-pro-image-preview` (通称: Nano Banana Pro)
    *   **Role:** 日本のnote文化に馴染む、清潔感のあるミニマルなアイキャッチ画像の生成。
    *   **Fallback Strategy:**
        1.  `gemini-3-pro-image-preview`
        2.  `gemini-2.0-flash-exp`
        3.  `gemini-2.0-flash`
        4.  `imagen-3.0-generate-001`
        5.  `Pollinations AI` (最終手段として確実に画像を返す。Fluxモデル使用)

---

## 3. 機能要件

### 3.1 記事執筆機能
*   **自動設定 (AI Recommendation):** 「AIにおまかせ設定」ボタンにより、入力されたテーマから最適な読者層・目的・トーンを自動入力。
*   **入力:** テーマ、想定読者、目的、目標文字数、トーン、差別化ポイント。（画風・キャラ指定含む）
*   **プロセス:**
    1.  入力情報の構造化・要約。
    2.  H2/H3見出しを含む構成案の作成。
    3.  「結論→理由→具体例→まとめ」の論理構成での本文執筆。
    4.  **推敲フェーズ:** 生成された文章に対し、品質向上のための内部チェック（模擬的）を実施。
*   **出力:** Markdown形式の記事本文。

### 3.2 品質スコア評価 (Scoring Logic)
生成された記事に対し、以下のロジックで100点満点のスコアを算出する。
*   **文字数達成度 (15%):** 目標文字数に対する達成率（0.9〜1.2倍で満点）。
*   **読みやすさ (25%):** 平均文長の適切さ（35〜55文字推奨）。
*   **構成の質 (20%):** H2/H3見出しの数とバランス（H2: 5-7個推奨）。
*   **充実度 (20%):** 段落数、リストの使用、「例えば」等の具体例キーワードの有無。
*   **SEO最適度 (20%):** タイトル文字数（28〜45文字推奨）とキーワード。

### 3.3 アイキャッチ画像生成
*   **詳細設定:** ユーザーは「画風（写真リアル/アニメ塗り等）」と「キャラクター（女性/猫/ロボット等）」を指定可能。
*   **プロンプト生成:** 記事本文から「テーマ要約」を抽出し、上記設定と組み合わせて英語の画像生成プロンプトを作成。
*   **タイトル合成 (Title Overlay):** 生成された純粋な画像の上に、CSS/HTMLレイヤーで記事タイトルを美しくオーバーレイ表示する（文字化け回避のため）。

### 3.4 ネクストアクション (Post-Generation)
*   **X告知:** 生成された記事を要約し、魅力的な投稿文を作成。
*   **有料化:** 記事の内容に基づき、有料noteとして販売するための付加価値アイデアを提案。

---

## 4. UI/UX仕様
*   **デザイン:** ダークモード基調、パープル/ブルーのグラデーション、Glassmorphism対応のカードUI。
*   **状態遷移:**
    *   `idle` (入力待ち)
    *   `outline/writing` (構成・執筆中)
    *   `polish/image_prompt` (推敲・画像準備中)
    *   `done` (結果表示)
*   **フィードバック:** 「推敲中」「画像作成中」を含む詳細なログを表示。

---

## 5. 運用・保守
*   **プロンプト管理:** AIの挙動（人格、口調、制約）はプロンプト内で定義し、コードとは分離して管理することを推奨。
*   **エラーハンドリング:** 画像生成失敗時はPollinations AIへフォールバックし、体験を途切れさせない。
