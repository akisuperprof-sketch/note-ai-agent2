# note.com 下書き投稿自動化 調査・フロー記録 (2026/01/02)

## 1. 調査結果まとめ
note.comのエディタ（`editor.note.com`）において、Playwright等による自動入力が失敗しやすかった原因と、その解決策を特定しました。

### セレクター情報
- **タイトル入力欄**: `textarea[placeholder="記事タイトル"]`
  - React等のステート管理下にあるため、単純な `fill()` では無視されるケースがある。
- **本文入力欄**: `div.ProseMirror[role="textbox"]`
  - ProseMirror（リッチテキストエディタ）を使用しており、内部の `<p>` タグや `innerHTML` を操作する必要がある。
- **保存ボタン**:
  - テキストとして「下書き保存」を含む `button` 要素。

### 技術的課題と対策
- **Reactステートの同期**: 
  JavaScriptのネイティブセッター (`Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype, "value").set`) を明示的に呼び出し、かつ `input` / `change` イベントを発火させることで、React側に「文字が入力されたこと」を正しく認識させる必要がある。
- **オートセーブのトリガー**:
  入力後、キーボードイベント（スペース入力 -> バックスペース等）をシミュレートすることで、エディタ側のオートセーブロジックを確実に走らせる。

## 2. 自動化実行フロー
現在実装されている最新の `route.ts` の処理プロセスは以下の通りです。

1. **セッション初期化**: 
   保存済みのクッキーを使用してログイン。期限切れの場合は提供されたID/Passで再ログインを実行。
2. **ナビゲーション**: 
   `https://note.com/notes/new` へアクセス。自動的に最新のエディタURLへリダイレクトされる。
3. **要素特定**: 
   `evaluate` 内で「タイトル」「本文」「下書き保存」の各要素を現在のDOMから正確に抽出。
4. **堅牢な入力 (Force Input)**:
   - 要素をクリックしフォーカス。
   - JavaScript経由でプロパティを直接書き換え。
   - イベント発火によるステート同期。
   - キーボード操作による入力確定。
5. **保存確定**: 
   「下書き保存」ボタンを明示的にクリックし、数秒待機。
6. **完了検証**: 
   URLが `/new` から `/edit/`（固有ID付き）に変わることをもって成功と判定。

## 3. テスト済みアカウント
- UserID: aki.superprof@gmail.com
- Status: 正常にログイン・下書き作成ができることを確認。

---
*この記録は、今後の note.com 仕様変更に伴うメンテナンスの基礎資料として保管します。*
