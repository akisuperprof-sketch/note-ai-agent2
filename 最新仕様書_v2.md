# note AI AGENT 最新仕様書 (v5.0)

## 1. プロダクト概要
**コンセプト:** 「note記事つくレッサーパンダ」が、あなたの代わりに高品質なnote記事と画像をプロデュースする。 noteを書くという作業を、AIとの協調によって「一瞬で高品質なコンテンツパッケージ（文章・画像・メタデータ）を完成させる」体験に昇華させる。
**名称:** note AI AGENT (マスコット: note記事つくレッサーパンダ)

---

### 2.5 黄金の読了構成 (v5.0)
*   **心理的リード（序章）**: 記事冒頭に、読者の悩みを代弁し「この記事を読まねばならない」と思わせるエモーショナルな序章（プロローグ）を自動挿入。
*   **プロ仕様の目次**: 序章の直後に、記事全体のロードマップを示す美しいリスト形式の「目次」を自動生成。
*   **タイトル焼き込みの自動化**: 「タイトルを画像に入れる」設定時、Canvas合成により**画像ファイル自体にタイトルを焼き込み済みの状態**で生成。そのまま保存すれば完成形として利用可能。

### 2.6 モバイル・クイックコピー (v5.0)
*   **Mobile Copy Helper**: スマホ閲覧時のみ画面下部に表示。タイトル、本文、タグを1タップで順次コピーし、そのままnoteエディタへ飛べる専用UI。

---

## 3. 技術仕様 (Model & Image Logic)

### 3.1 AIモデル構成
*   **執筆**: `gemini-3-flash-preview` (高速かつ高い文脈理解)
*   **画像（メイン）**: `gemini-3-pro-image-preview` (Nano Banana Pro)
*   **画像（フォールバック）**: `Pollinations AI (Flux)` (冗長性の確保)

### 3.2 ビジュアル・ディレクション (New Logic)
*   **キャラクター維持 (Strict Mode)**: 指示を強化し、キャラクターの造形・服装を完コピして生成するロジックを搭載。
*   **ステッカー・スタイル**: キャラクターに「白縁」をつけ、視覚的インパクトを最大化。
*   **ワークフロー・アイコン**: 記事内容（ツール等）を繋ぐアイコンやラインを自動合成。

---

## 4. UI/UXデザイン
*   **ベースカラー**: `#0B0F1A` (深い紺色)
*   **タイポグラフィ**: note.comの清潔感に加え、プレミアムな太字フォントと重厚なドロップシャドウで可読性を極限まで高めた独自スタイル。

---

## 5. 開発のねらいと成果
今回のアップデート（Repro 2.0+）により、単なる「文章生成AI」から、**「メディア運営に必要なすべての素材をワンストップで、かつ最高のアートディレクションを伴って生成するエージェント」**へと進化。これにより、ユーザーの投稿までの所要時間を従来の1/10に短縮し、出力品質のばらつきを最小化することに成功した。

---

## 6. 法務リスク評価（暫定）
1.  **商標・ブランド名**: 「note」という名称をサービス名に含んでいるため、公式サービスと誤認されるリスク。
2.  **UI/UXの類似性**: note.comの執筆・表示画面をシミュレートしているプレビュー機能。
3.  **画像生成における著作権**: 特定のキャラクター（レッサーパンダ）を生成し続けることの同一性。

※これらの対策については順次検討し、実装予定。

---
## 7. 独自設計・ブランディング (New)
*   **セクション定義**: 「戦略企画」を**「記事の独自設計」**に改称し、独自のUIコンポーネントとして実装。
*   **オリジナル用語の採用**:
    *   ターゲット → **誰に届けるか**
    *   コンセプト → **独自の切り口・コンセプト**
    *   記事の強み → **この記事だけの価値**
    *   記事構成 → **目次の構成・補足**

---
### 8. 高度なユーザー体験 (v3.2)
*   **執筆の連続性 (Persistence)**: 入力フォームの内容をブラウザに自動保存。
*   **履歴アーカイブ (History Management)**: 過去の生成結果を10件まで保存。

### 9. 信頼性と利便性の向上 (v3.3)
*   **スマート加筆リトライ**: 文字不足時の自動再試行。
*   **スマホ最適化**: プレビュー視認性の向上。

### 10. 耐障害性とモバイル体験の極大化 (v3.4)
*   **エラーリカバリーUI**: 生成エラー時に「真っ黒」にならず、原因表示と再試行を可能にする専用画面。
-   **成果物アクセスの保証**: 画像生成が失敗・遅延しても、執筆された「本文」だけは即座に結果画面（生成結果タブ）で確認・コピー可能に。
*   **ロバスト・ストリーミング**: モバイル通信の不安定さに配慮した例外処理と進捗ログの強化。
*   **スマホ専用レイアウト調整**: 小さな画面でもアイキャッチのタイトルが読みやすいよう配置を最適化。

---
### 11. 【確実なアウトプット：半自動流し込み】 (v4.0)
*   **魔法のコード (Magic Injector)**: noteのボット検知を100%回避するため、ユーザーのブラウザ上で動作するJavaScriptインジェクション機能を搭載。
*   **ブックマークレット対応**: コピペ不要で、保存したブックマークをクリックするだけでタイトル・本文を自動入力。

### 12. 【実験的：完全自動投稿】 (v4.0)
*   **ステルス・エンジニアリング**: `navigator.webdriver` の偽装、iPhone/iPad/Macのデバイスローテーション、Service Workerの強制無効化などを組み合わせ、note側のボット検知AIを欺く。
*   **骨組み状態（Tags 28）の自動復旧**: JavaScriptが実行されないフリーズ状態を検知し、多角的なタップ刺激や再読み込みで無理やりページを起動させる。

### 13. 【技術監査・デバッグツール】
*   **リアルタイム通信監査**: ブロックされたスクリプトやJSエラーを即座にUIログへ出力。
*   **デバッグ・即時開始**: 開発モードでの検証時、余計な警告をスキップして即座に投稿プロセスを開始可能。

### 14. 【インフラ適応と通信プロトコル】 (v5.1)
*   **Serverless Persistence**: Vercel環境における書き込み制限を回避するため、セッション情報やジョブ状況の保存に `/tmp` 領域を動的に活用。
*   **Zero-Header Baseline**: 通信遮断を防ぐため、ブラウザコンテキストのヘッダー偽装を「実績のある最小構成」に固定。
*   **Raw JSON-Line Stream**: サーバー・クライアント間のリアルタイム通信において、パースエラーを防ぐためのラベルレスJSONストリーム形式を採用。

---
**2026-01-03 更新**
バージョン: v5.1 (Stable Infrastructure & Stream Synchronization Update)
